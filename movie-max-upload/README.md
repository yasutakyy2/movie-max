# 映画最適化システム (Movie Optimization System)

新宿エリアの映画館情報をクローリングし、時間制約を考慮した最適な映画鑑賞プランを提案するWebアプリケーションです。

## システム概要

このシステムは以下の機能を提供します：
- 映画.comからの新宿エリア映画館データのクローリング
- 時間制約に基づく映画検索
- 移動時間を考慮した最適化プラン生成
- 分単位での詳細な上映時間表示
- リアルタイムなクローリング状況表示

## 主要コンポーネント

### 1. Webアプリケーション
- **app.py**: FastAPIベースのWebサーバー
- **static/index.html**: React.jsフロントエンドアプリケーション

### 2. データベース管理
- **database_manager.py**: SQLiteデータベース操作クラス
- **movie_optimization.db**: メインデータベース
- **database_schema.sql**: データベーススキーマ定義

### 3. 最適化エンジン
- **enhanced_optimizer.py**: 映画鑑賞プラン最適化アルゴリズム
- **optimization_api.py**: 最適化機能のAPIインターフェース

### 4. データクローリング
- **complete_eiga_crawler.py**: 映画.comからの完全データクローリング
- **quick_nakayama_search.py**: 特定映画の検索機能

## セットアップ

### 1. 依存関係のインストール
```bash
pip install fastapi uvicorn requests beautifulsoup4 sqlite3
```

### 2. データベースの初期化
```bash
python setup_database.py
```

### 3. データのクローリング
```bash
python complete_eiga_crawler.py
```

### 4. Webアプリケーションの起動
```bash
python app.py
```

アプリケーションは http://localhost:8000 でアクセス可能です。

## 使用方法

### 1. 時間選択
- 希望の日付と時間範囲を選択
- プリセット時間帯（午後の部、夕方の部、夜の部、レイトショー）を利用可能

### 2. 映画選択
- 時間制約内の映画一覧から目標映画を選択
- 映画ポスター画像とクローリング状況が表示

### 3. 最適化プラン表示
- 選択した映画を中心とした最適化プランを表示
- 単発、前+メイン、メイン+後、3本立てプランに対応
- 移動時間と余裕時間を考慮した詳細なスケジュール

## 特徴的な機能

### 時間制約の厳密な適用
- 指定された時間範囲内に完全に収まる映画のみを表示
- プラン生成時も時間制約を厳密にチェック

### 分単位の詳細時間表示
- 「19:00 (1140分経過)」形式での時間表示
- 上映時間（○○分）の表示は除去

### リアルタイムクローリング状況
- クローリング成功率の表示
- 映画館別のデータ取得状況
- データの新鮮度インジケーター

### 最適化アルゴリズム
- 移動時間を考慮したプラン生成
- バッファータイムの設定
- スコアベースでの最適プラン選出

## データベーススキーマ

### 主要テーブル
- **theaters**: 映画館情報
- **movies**: 映画情報
- **showtimes**: 上映時間情報
- **viewing_plans**: 生成されたプラン
- **crawling_status**: クローリング状況

## API エンドポイント

- `GET /`: メインページ
- `GET /api/stats`: システム統計情報
- `GET /api/movies`: 映画検索
- `POST /api/optimize`: プラン最適化
- `GET /api/crawling-status`: クローリング状況
- `GET /api/theaters`: 映画館一覧

## 設定

### 時間制約
- デフォルト移動時間: 30分
- バッファータイム: 15分
- 最大総所要時間: 480分（8時間）

### クローリング設定
- リクエスト間隔: 1-2秒
- タイムアウト: 15秒
- リトライ: 自動実行

## 対応映画館

新宿エリアの主要映画館（10館）:
- 新宿ピカデリー
- 新宿バルト9
- TOHOシネマズ新宿
- 新宿武蔵野館
- テアトル新宿
- シネマート新宿
- kino cinema新宿
- 新宿シネマカリテ
- 109シネマズプレミアム新宿
- Ks cinema

## トラブルシューティング

### よくある問題
1. **ポート8000が使用中**: 既存のプロセスを終了してから再起動
2. **クローリングエラー**: ネットワーク接続とサイトの可用性を確認
3. **データベースエラー**: `setup_database.py`でデータベースを再初期化

### ログファイル
- アプリケーションログ: コンソール出力
- クローリングログ: `movie_crawler.log`

## 注意事項

- 映画.comの利用規約を遵守してください
- 適切なリクエスト間隔を維持しています
- 教育・研究目的での使用を想定しています

## ライセンス

このシステムは教育・研究目的で開発されています。商用利用は避けてください。

## 更新履歴

- v1.0: 基本的なクローリングと最適化機能
- v1.1: 時間制約の厳密化
- v1.2: 分単位時間表示とUI改善
- v1.3: クローリング状況表示機能追加