# 映画最適化システム データベース設計 完了レポート

## 📊 概要

映画最適化システムのデータベース設計・構築が完了しました。SQLiteを使用して、クローリングデータの永続化と最適化アルゴリズムのためのデータ基盤を構築しました。

## 🗄️ データベース構造

### 作成されたテーブル

1. **theaters** - 映画館情報
   - 9館のデータ（新宿エリア）
   - 座標情報、スクリーン数、設備情報を含む

2. **movies** - 映画情報
   - 11作品のデータ
   - タイトル、上映時間、レーティング、ジャンル情報

3. **showtimes** - 上映スケジュール
   - 13件の上映データ（2025-07-14 19時台）
   - 開始時間、終了時間、スクリーン番号、料金情報

4. **theater_distances** - 映画館間距離
   - 24件の距離データ
   - 徒歩、電車、タクシーの移動時間

5. **viewing_plans** - 閲覧プラン（準備完了）
6. **plan_recommendations** - プラン推薦（準備完了）
7. **crawling_logs** - クローリングログ（準備完了）

## 📁 作成されたファイル

### 1. データベース設計ファイル
- `database_schema.sql` - テーブル定義DDL
- `setup_database.py` - データベース初期化スクリプト

### 2. データ操作ファイル
- `database_manager.py` - メインデータベース操作クラス
- `data_importer.py` - クローリングデータ投入プログラム
- `test_database.py` - データベーステストスイート

### 3. データファイル
- `movie_optimization.db` - SQLiteデータベースファイル

## 🎯 実装された機能

### データベース操作
- ✅ 映画館データの管理
- ✅ 映画データの管理
- ✅ 上映スケジュールの管理
- ✅ 映画館間距離の管理
- ✅ クローリングデータの自動投入
- ✅ データの整合性チェック

### 最適化支援機能
- ✅ 19時台上映の絞り込み
- ✅ 映画館間移動時間の取得
- ✅ 上映前後の映画候補検索
- ✅ データベース統計情報の取得

## 📊 データ統計

| 項目 | 件数 |
|------|------|
| 映画館 | 9館 |
| 映画作品 | 11作品 |
| 上映回数 | 13回 |
| 19時台上映 | 13回 |
| 距離データ | 24件 |

## 🏛️ 新宿エリア映画館

1. **新宿ピカデリー** (11スクリーン)
2. **新宿バルト9** (9スクリーン)
3. **TOHOシネマズ新宿** (12スクリーン)
4. **シネマート新宿** (7スクリーン)
5. **新宿シネマカリテ** (2スクリーン)
6. **新宿武蔵野館** (4スクリーン)
7. **テアトル新宿** (3スクリーン)
8. **109シネマズプレミアム新宿** (8スクリーン)
9. **kino cinema新宿** (4スクリーン)

## 🎬 取得された映画データ（2025-07-14 19時台）

### 主要上映作品
- **スティッチ** (複数館で上映)
- **小林さんちのメイドラゴン　さみしがりやの竜**
- **映画「F1（R） エフワン」** (複数館で上映)
- **インポッシブル　ファイナル・レコニング**
- **フロントライン**
- **LUPIN THE IIIRD THE MOVIE 不死身の血族**

### 時間別分布
- **19:00開始**: 2作品
- **19:05開始**: 2作品
- **19:15開始**: 3作品
- **19:20開始**: 1作品
- **19:25開始**: 2作品
- **19:30開始**: 2作品
- **19:35開始**: 1作品

## 🔧 技術仕様

### データベース
- **エンジン**: SQLite 3
- **文字エンコーディング**: UTF-8
- **外部キー制約**: 有効
- **トランザクション**: 対応

### Python実装
- **言語**: Python 3.10+
- **データベースライブラリ**: sqlite3 (標準)
- **JSON処理**: json (標準)
- **日時処理**: datetime (標準)

## ✅ 品質テスト結果

### データ整合性
- **外部キー制約**: ✅ 違反なし
- **時間の妥当性**: ✅ 問題なし
- **重複データ**: ✅ なし
- **データ品質**: ✅ 良好

### 機能テスト
- **基本CRUD操作**: ✅ 正常動作
- **クローリングデータ投入**: ✅ 正常動作
- **最適化シナリオ**: ✅ 検索可能
- **距離計算**: ✅ 正常動作

## 🚀 次のステップ

このデータベース基盤を使用して、以下の機能を実装できます：

### 1. 最適化アルゴリズム実装
- 移動時間を考慮した映画組み合わせ計算
- 3本立てプランの自動生成
- 最適化スコアの算出

### 2. Webアプリケーション開発
- React + TypeScriptでのフロントエンド
- ユーザー選択映画からの最適プラン提案
- 地図表示での移動ルート可視化

### 3. リアルタイム更新機能
- 定期的なクローリングデータ更新
- 上映スケジュール変更の自動検出
- データベースの自動メンテナンス

## 📋 使用方法

### データベース初期化
```bash
python setup_database.py
```

### データ投入
```bash
python database_manager.py
```

### データベーステスト
```bash
python test_database.py
```

### Python API使用例
```python
from database_manager import DatabaseManager

with DatabaseManager() as db:
    # 19時台の上映取得
    showtimes = db.get_19h_showtimes()
    
    # 映画館間移動時間取得
    travel_time = db.get_travel_time(1, 2)
    
    # 統計情報取得
    stats = db.get_database_stats()
```

## ✨ 完了事項

- ✅ データベース設計・スキーマ作成
- ✅ SQLiteでのテーブル作成DDL作成
- ✅ クローリングデータの投入用プログラム作成
- ✅ データベース操作用のクラス作成
- ✅ 移動時間データの初期セットアップ
- ✅ データベース動作確認・テスト

## 📞 サポート

データベース関連の問題や追加機能の要望がございましたら、開発チームまでお声がけください。

---

**映画最適化システム データベース設計完了**  
作成日: 2025年7月14日  
データベースファイル: `movie_optimization.db`