<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜ ç”»æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ </title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .movie-card {
            transition: all 0.3s ease;
        }
        .movie-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .plan-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .score-circle {
            background: conic-gradient(from 0deg, #10b981 calc(var(--score) * 3.6deg), #e5e7eb calc(var(--score) * 3.6deg));
        }
        .time-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function TimeInputForm({ onTimeSubmit, isLoading }) {
            const [date, setDate] = useState('2025-07-15');
            const [timeFrom, setTimeFrom] = useState('19:00');
            const [timeTo, setTimeTo] = useState('21:00');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (timeFrom >= timeTo) {
                    alert('é–‹å§‹æ™‚é–“ã¯çµ‚äº†æ™‚é–“ã‚ˆã‚Šå‰ã«è¨­å®šã—ã¦ãã ã•ã„');
                    return;
                }
                onTimeSubmit(date, timeFrom, timeTo);
            };

            const timeSlots = [
                { label: 'åˆå¾Œã®éƒ¨', from: '14:00', to: '17:00' },
                { label: 'å¤•æ–¹ã®éƒ¨', from: '17:00', to: '20:00' },
                { label: 'å¤œã®éƒ¨', from: '19:00', to: '22:00' },
                { label: 'ãƒ¬ã‚¤ãƒˆã‚·ãƒ§ãƒ¼', from: '21:00', to: '24:00' },
                { label: 'å…¨æ™‚é–“', from: '09:00', to: '24:00' }
            ];

            return (
                <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <div className="text-center mb-8">
                        <h2 className="text-3xl font-bold text-gray-900 mb-2">ğŸ¬ æ˜ ç”»ã‚’è¦‹ã‚‹æ™‚é–“ã‚’é¸æŠ</h2>
                        <p className="text-gray-600">å¸Œæœ›ã®æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ã€æœ€é©ãªæ˜ ç”»ãƒ—ãƒ©ãƒ³ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†</p>
                    </div>

                    {/* æ™‚é–“å¸¯ãƒ—ãƒªã‚»ãƒƒãƒˆ */}
                    <div className="mb-6">
                        <p className="text-sm font-medium text-gray-700 mb-3">ãŠã™ã™ã‚æ™‚é–“å¸¯</p>
                        <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                            {timeSlots.map((slot) => (
                                <button
                                    key={slot.label}
                                    onClick={() => {
                                        setTimeFrom(slot.from);
                                        setTimeTo(slot.to);
                                    }}
                                    className="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-blue-50 hover:border-blue-300 transition-colors"
                                >
                                    <div className="font-medium">{slot.label}</div>
                                    <div className="text-xs text-gray-500">{slot.from}-{slot.to}</div>
                                </button>
                            ))}
                        </div>
                    </div>

                    <form onSubmit={handleSubmit} className="space-y-6">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {/* æ—¥ä»˜ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ğŸ“… æ—¥ä»˜
                                </label>
                                <input
                                    type="date"
                                    value={date}
                                    onChange={(e) => setDate(e.target.value)}
                                    min="2025-07-15"
                                    max="2025-07-21"
                                    className="time-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none transition-all"
                                    required
                                />
                            </div>

                            {/* é–‹å§‹æ™‚é–“ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ğŸ•’ é–‹å§‹æ™‚é–“
                                </label>
                                <input
                                    type="time"
                                    value={timeFrom}
                                    onChange={(e) => setTimeFrom(e.target.value)}
                                    className="time-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none transition-all"
                                    required
                                />
                            </div>

                            {/* çµ‚äº†æ™‚é–“ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ğŸ•• çµ‚äº†æ™‚é–“
                                </label>
                                <input
                                    type="time"
                                    value={timeTo}
                                    onChange={(e) => setTimeTo(e.target.value)}
                                    className="time-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none transition-all"
                                    required
                                />
                            </div>
                        </div>

                        {/* æ™‚é–“ç¯„å›²è¡¨ç¤º */}
                        <div className="bg-blue-50 rounded-lg p-4">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-blue-600 font-medium">é¸æŠã•ã‚ŒãŸæ™‚é–“ç¯„å›²</p>
                                    <p className="text-lg font-bold text-blue-900">
                                        {date} {timeFrom} ã€œ {timeTo}
                                    </p>
                                </div>
                                <div className="text-blue-600">
                                    <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        {/* æ¤œç´¢ãƒœã‚¿ãƒ³ */}
                        <button
                            type="submit"
                            disabled={isLoading}
                            className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-4 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 transition-all shadow-lg"
                        >
                            {isLoading ? (
                                <div className="flex items-center justify-center">
                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                                    æ˜ ç”»ã‚’æ¤œç´¢ä¸­...
                                </div>
                            ) : (
                                <div className="flex items-center justify-center">
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                    æ˜ ç”»ã‚’æ¤œç´¢
                                </div>
                            )}
                        </button>
                    </form>
                </div>
            );
        }

        function TheaterModal({ isOpen, onClose, theaters }) {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={onClose}>
                    <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold text-gray-900">æ˜ ç”»é¤¨ä¸€è¦§</h2>
                            <button 
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-600 text-2xl"
                            >
                                Ã—
                            </button>
                        </div>
                        
                        <div className="space-y-3">
                            {theaters && theaters.length > 0 ? (
                                theaters.map((theater, index) => (
                                    <div key={index} className="p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                                        <h3 className="font-semibold text-lg text-gray-800">{theater.name}</h3>
                                        <p className="text-gray-600 text-sm">{theater.address || 'æ–°å®¿åŒº'}</p>
                                        <div className="flex justify-between items-center mt-2">
                                            <span className="text-sm text-gray-500">
                                                ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ•°: {theater.screens || 'N/A'}
                                            </span>
                                            <span className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                                {theater.area || 'æ–°å®¿'}
                                            </span>
                                        </div>
                                    </div>
                                ))
                            ) : (
                                <p className="text-gray-500 text-center py-4">æ˜ ç”»é¤¨ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function MovieCard({ movie, onSelect, selected }) {
            return (
                <div 
                    className={`movie-card p-4 border rounded-lg cursor-pointer ${
                        selected ? 'border-blue-500 bg-blue-50' : 'border-gray-200 bg-white'
                    }`}
                    onClick={() => onSelect(movie)}
                >
                    <div className="flex gap-4 mb-2">
                        {movie.image_url && movie.image_url.length > 0 && (
                            <div className="flex-shrink-0">
                                <img 
                                    src={movie.image_url} 
                                    alt={movie.movie_title}
                                    className="w-16 h-24 object-cover rounded"
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                        console.log('Image failed to load:', movie.image_url);
                                    }}
                                    onLoad={(e) => {
                                        console.log('Image loaded successfully:', movie.image_url);
                                    }}
                                />
                            </div>
                        )}
                        <div className="flex-1">
                            <div className="flex justify-between items-start mb-2">
                                <h3 className="font-semibold text-lg text-gray-800 leading-tight">
                                    {movie.movie_title || 'æ˜ ç”»åãªã—'}
                                </h3>
                                <span className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                    Â¥{movie.price}
                                </span>
                            </div>
                        </div>
                    </div>
                    <p className="text-gray-600 mb-2">{movie.theater_name}</p>
                    <div className="flex justify-between items-center text-sm text-gray-500">
                        <span>{formatTimeWithMinutes(movie.start_time)} - {formatTimeWithMinutes(movie.end_time)}</span>
                        <span>ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ {movie.screen_number}</span>
                    </div>
                </div>
            );
        }

        function PlanCard({ plan, rank }) {
            const getBadgeColor = (planType) => {
                switch(planType) {
                    case 'single': return 'bg-green-500';
                    case 'before_only': case 'after_only': return 'bg-blue-500';
                    case 'before_after': return 'bg-purple-500';
                    default: return 'bg-gray-500';
                }
            };

            const getPlanTypeLabel = (planType) => {
                switch(planType) {
                    case 'single': return 'å˜ç™º';
                    case 'before_only': return 'å‰+ãƒ¡ã‚¤ãƒ³';
                    case 'after_only': return 'ãƒ¡ã‚¤ãƒ³+å¾Œ';
                    case 'before_after': return '3æœ¬ç«‹ã¦';
                    default: return planType;
                }
            };

            return (
                <div className="bg-white rounded-lg shadow-md p-6 mb-4">
                    <div className="flex justify-between items-start mb-4">
                        <div className="flex items-center space-x-3">
                            <span className="text-2xl font-bold text-gray-400">#{rank}</span>
                            <div>
                                <span className={`${getBadgeColor(plan.plan_type)} text-white px-3 py-1 rounded-full text-sm font-medium`}>
                                    {getPlanTypeLabel(plan.plan_type)}
                                </span>
                            </div>
                        </div>
                        <div className="text-right">
                            <div 
                                className="score-circle w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-lg"
                                style={{'--score': plan.optimization_score}}
                            >
                                {Math.round(plan.optimization_score)}
                            </div>
                            <p className="text-xs text-gray-500 mt-1">ã‚¹ã‚³ã‚¢</p>
                        </div>
                    </div>

                    <div className="space-y-3">
                        {plan.before_showtime && (
                            <div className="flex items-center space-x-3 p-3 bg-gray-50 rounded">
                                <span className="text-sm bg-gray-500 text-white px-2 py-1 rounded">å‰</span>
                                <div className="flex-1">
                                    <p className="font-medium">{plan.before_showtime.movie_title}</p>
                                    <p className="text-sm text-gray-600">
                                        {formatTimeWithMinutes(plan.before_showtime.start_time)} - {formatTimeWithMinutes(plan.before_showtime.end_time)} | {plan.before_showtime.theater_name}
                                    </p>
                                </div>
                            </div>
                        )}

                        <div className="flex items-center space-x-3 p-3 bg-blue-50 rounded">
                            <span className="text-sm bg-blue-500 text-white px-2 py-1 rounded">ãƒ¡ã‚¤ãƒ³</span>
                            <div className="flex-1">
                                <p className="font-medium">{plan.primary_showtime.movie_title}</p>
                                <p className="text-sm text-gray-600">
                                    {formatTimeWithMinutes(plan.primary_showtime.start_time)} - {formatTimeWithMinutes(plan.primary_showtime.end_time)} | {plan.primary_showtime.theater_name}
                                </p>
                            </div>
                        </div>

                        {plan.after_showtime && (
                            <div className="flex items-center space-x-3 p-3 bg-gray-50 rounded">
                                <span className="text-sm bg-gray-500 text-white px-2 py-1 rounded">å¾Œ</span>
                                <div className="flex-1">
                                    <p className="font-medium">{plan.after_showtime.movie_title}</p>
                                    <p className="text-sm text-gray-600">
                                        {formatTimeWithMinutes(plan.after_showtime.start_time)} - {formatTimeWithMinutes(plan.after_showtime.end_time)} | {plan.after_showtime.theater_name}
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="grid grid-cols-3 gap-4 mt-4 pt-4 border-t border-gray-200">
                        <div className="text-center">
                            <p className="text-lg font-semibold text-gray-800">{plan.total_duration_minutes}åˆ†</p>
                            <p className="text-xs text-gray-500">ç·æ™‚é–“</p>
                        </div>
                        <div className="text-center">
                            <p className="text-lg font-semibold text-gray-800">{plan.total_travel_minutes}åˆ†</p>
                            <p className="text-xs text-gray-500">ç§»å‹•æ™‚é–“</p>
                        </div>
                        <div className="text-center">
                            <p className="text-lg font-semibold text-gray-800">{plan.total_movie_minutes}åˆ†</p>
                            <p className="text-xs text-gray-500">æ˜ ç”»æ™‚é–“</p>
                        </div>
                    </div>

                    {plan.travel_details && plan.travel_details.length > 0 && (
                        <div className="mt-4 pt-4 border-t border-gray-200">
                            <h4 className="text-sm font-medium text-gray-700 mb-2">ç§»å‹•è©³ç´°</h4>
                            {plan.travel_details.map((travel, index) => (
                                <div key={index} className="text-sm text-gray-600 flex justify-between">
                                    <span>{travel.from} â†’ {travel.to}</span>
                                    <span>{travel.travel_time}åˆ† (ä½™è£•{travel.buffer_time}åˆ†)</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function CrawlingStatusDisplay({ crawlingStatus }) {
            if (!crawlingStatus) return null;

            const { overall_stats, theater_status, data_freshness } = crawlingStatus;
            const statusColor = data_freshness === 'recent' ? 'text-green-600' : 'text-yellow-600';
            const statusBg = data_freshness === 'recent' ? 'bg-green-50' : 'bg-yellow-50';

            return (
                <div className={`p-3 rounded-lg mb-4 ${statusBg}`}>
                    <div className="flex items-center justify-between">
                        <div className="flex items-center space-x-2">
                            <div className={`w-2 h-2 rounded-full ${data_freshness === 'recent' ? 'bg-green-500' : 'bg-yellow-500'}`}></div>
                            <span className={`text-sm font-medium ${statusColor}`}>
                                ã‚¯ãƒ­ãƒ¼ãƒªãƒ³ã‚°çŠ¶æ³: {overall_stats.success_rate}%
                            </span>
                        </div>
                        <span className="text-xs text-gray-500">
                            {overall_stats.total_movies}ä½œå“ / {overall_stats.total_theaters}é¤¨
                        </span>
                    </div>
                    
                    <div className="mt-2 grid grid-cols-2 gap-2 text-xs">
                        {theater_status.slice(0, 4).map((theater, index) => (
                            <div key={index} className="flex justify-between">
                                <span className="text-gray-600">{theater.theater_name}</span>
                                <span className={theater.status === 'active' ? 'text-green-600' : 'text-red-600'}>
                                    {theater.total_movies}ä½œå“
                                </span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // æ™‚é–“ã‚’åˆ†å˜ä½ã§è©³ç´°è¡¨ç¤ºã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function formatTimeWithMinutes(timeStr) {
            if (!timeStr) return '';
            const [hours, minutes] = timeStr.split(':').map(Number);
            const totalMinutes = hours * 60 + minutes;
            return `${hours}:${minutes.toString().padStart(2, '0')} (${totalMinutes}åˆ†çµŒé)`;
        }

        function App() {
            const [currentStep, setCurrentStep] = useState('time-input'); // 'time-input', 'movie-selection', 'plan-view'
            const [searchParams, setSearchParams] = useState({ date: '', timeFrom: '', timeTo: '' });
            const [movies, setMovies] = useState([]);
            const [selectedMovie, setSelectedMovie] = useState(null);
            const [plans, setPlans] = useState([]);
            const [loading, setLoading] = useState(false);
            const [stats, setStats] = useState(null);
            const [theaters, setTheaters] = useState([]);
            const [showTheaterModal, setShowTheaterModal] = useState(false);
            const [crawlingStatus, setCrawlingStatus] = useState(null);

            useEffect(() => {
                fetchStats();
                fetchCrawlingStatus();
            }, []);

            const fetchStats = async () => {
                try {
                    const response = await fetch('/api/stats');
                    const data = await response.json();
                    if (data.success) {
                        setStats(data.stats);
                    }
                } catch (error) {
                    console.error('Error fetching stats:', error);
                }
            };

            const fetchCrawlingStatus = async () => {
                try {
                    const response = await fetch('/api/crawling-status');
                    const data = await response.json();
                    if (data.success) {
                        setCrawlingStatus(data);
                    }
                } catch (error) {
                    console.error('Error fetching crawling status:', error);
                }
            };

            const handleTimeSubmit = async (date, timeFrom, timeTo) => {
                setLoading(true);
                setSearchParams({ date, timeFrom, timeTo });

                try {
                    const response = await fetch(`/api/movies?date=${date}&time_from=${timeFrom}&time_to=${timeTo}`);
                    const data = await response.json();
                    if (data.success) {
                        setMovies(data.movies);
                        setCurrentStep('movie-selection');
                        console.log(`Found ${data.movies.length} movies for ${timeFrom}-${timeTo}`);
                    }
                } catch (error) {
                    console.error('Error fetching movies:', error);
                    alert('æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                } finally {
                    setLoading(false);
                }
            };

            const fetchTheaters = async () => {
                try {
                    const response = await fetch('/api/theaters');
                    const data = await response.json();
                    if (data.success) {
                        setTheaters(data.theaters);
                        setShowTheaterModal(true);
                    }
                } catch (error) {
                    console.error('Error fetching theaters:', error);
                }
            };

            const optimizePlan = async (movie) => {
                setLoading(true);
                try {
                    const response = await fetch('/api/optimize', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            showtime_id: movie.showtime_id,
                            max_travel_time: 30,
                            buffer_time: 15,
                            plan_type: 'all',
                            max_total_duration: 480,
                            time_from: searchParams.timeFrom,
                            time_to: searchParams.timeTo
                        }),
                    });
                    const data = await response.json();
                    if (data.success) {
                        setPlans(data.plans);
                        setCurrentStep('plan-view');
                    }
                } catch (error) {
                    console.error('Error optimizing plan:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleMovieSelect = (movie) => {
                setSelectedMovie(movie);
                optimizePlan(movie);
            };

            const resetSearch = () => {
                setCurrentStep('time-input');
                setMovies([]);
                setSelectedMovie(null);
                setPlans([]);
                setSearchParams({ date: '', timeFrom: '', timeTo: '' });
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-6">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-900">æ˜ ç”»æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ </h1>
                                    <p className="text-gray-600">ç§»å‹•æ™‚é–“ã‚’è€ƒæ…®ã—ãŸæœ€é©ãªæ˜ ç”»é‘‘è³ãƒ—ãƒ©ãƒ³ã‚’ææ¡ˆ</p>
                                </div>
                                {stats && (
                                    <div className="text-right">
                                        <div className="text-sm text-gray-500">
                                            æ˜ ç”»é¤¨: <button 
                                                onClick={fetchTheaters}
                                                className="text-blue-600 hover:text-blue-800 hover:underline cursor-pointer font-medium"
                                            >
                                                {stats.theaters}é¤¨
                                            </button> | æ˜ ç”»: {stats.movies}ä½œå“ | ä¸Šæ˜ : {stats.showtimes}å›
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {/* ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */}
                        {currentStep !== 'time-input' && (
                            <div className="mb-8">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center space-x-4">
                                        <button
                                            onClick={resetSearch}
                                            className="flex items-center text-blue-600 hover:text-blue-800"
                                        >
                                            <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                            </svg>
                                            æ–°ã—ã„æ¤œç´¢
                                        </button>
                                        {searchParams.date && (
                                            <div className="text-sm text-gray-600">
                                                {searchParams.date} {searchParams.timeFrom}ã€œ{searchParams.timeTo}
                                            </div>
                                        )}
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <div className={`w-3 h-3 rounded-full ${currentStep === 'time-input' ? 'bg-blue-500' : 'bg-green-500'}`}></div>
                                        <span className="text-sm">æ™‚é–“é¸æŠ</span>
                                        <div className={`w-3 h-3 rounded-full ${currentStep === 'movie-selection' ? 'bg-blue-500' : currentStep === 'plan-view' ? 'bg-green-500' : 'bg-gray-300'}`}></div>
                                        <span className="text-sm">æ˜ ç”»é¸æŠ</span>
                                        <div className={`w-3 h-3 rounded-full ${currentStep === 'plan-view' ? 'bg-blue-500' : 'bg-gray-300'}`}></div>
                                        <span className="text-sm">ãƒ—ãƒ©ãƒ³è¡¨ç¤º</span>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Step 1: æ™‚é–“å…¥åŠ› */}
                        {currentStep === 'time-input' && (
                            <TimeInputForm onTimeSubmit={handleTimeSubmit} isLoading={loading} />
                        )}

                        {/* Step 2: æ˜ ç”»é¸æŠ */}
                        {currentStep === 'movie-selection' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 mb-6">
                                    æ˜ ç”»ã‚’é¸æŠ ({movies.length}ä»¶)
                                </h2>
                                
                                {/* ã‚¯ãƒ­ãƒ¼ãƒªãƒ³ã‚°çŠ¶æ³è¡¨ç¤º */}
                                <CrawlingStatusDisplay crawlingStatus={crawlingStatus} />
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {movies.length > 0 ? (
                                        movies.map((movie) => (
                                            <MovieCard
                                                key={movie.showtime_id}
                                                movie={movie}
                                                onSelect={handleMovieSelect}
                                                selected={selectedMovie?.showtime_id === movie.showtime_id}
                                            />
                                        ))
                                    ) : (
                                        <div className="col-span-full text-center text-gray-500 py-8">
                                            æŒ‡å®šã—ãŸæ™‚é–“å¸¯ã«ä¸Šæ˜ ã—ã¦ã„ã‚‹æ˜ ç”»ãŒã‚ã‚Šã¾ã›ã‚“
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Step 3: ãƒ—ãƒ©ãƒ³è¡¨ç¤º */}
                        {currentStep === 'plan-view' && (
                            <div>
                                {loading && (
                                    <div className="flex justify-center items-center h-64">
                                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                                    </div>
                                )}

                                {!loading && selectedMovie && (
                                    <div className="mb-6">
                                        <div className="bg-blue-50 rounded-lg p-6">
                                            <h2 className="text-2xl font-bold text-gray-900 mb-2">æœ€é©åŒ–ãƒ—ãƒ©ãƒ³</h2>
                                            <div className="flex items-center space-x-4">
                                                <div>
                                                    <h3 className="font-medium text-blue-900">é¸æŠã•ã‚ŒãŸæ˜ ç”»</h3>
                                                    <p className="text-blue-700 text-lg">{selectedMovie.movie_title}</p>
                                                    <p className="text-sm text-blue-600">{formatTimeWithMinutes(selectedMovie.start_time)} | {selectedMovie.theater_name}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {!loading && plans.length > 0 && (
                                    <div className="space-y-4">
                                        {plans.map((plan, index) => (
                                            <PlanCard key={plan.plan_id} plan={plan} rank={index + 1} />
                                        ))}
                                    </div>
                                )}

                                {!loading && plans.length === 0 && selectedMovie && (
                                    <div className="text-center text-gray-500 py-8">
                                        ã“ã®æ˜ ç”»ã®æœ€é©åŒ–ãƒ—ãƒ©ãƒ³ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸ
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Theater Modal */}
                    <TheaterModal 
                        isOpen={showTheaterModal}
                        onClose={() => setShowTheaterModal(false)}
                        theaters={theaters}
                    />
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>